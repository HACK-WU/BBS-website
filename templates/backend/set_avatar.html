{% extends "base.html" %}

{% block content %}
<h3 class="text-center">修改头像</h3>
    <form action=" " method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <p>
        原头像：
        <img src="/media/{{ request.user.avatar }}"/>
    </p>
    <p>
        <label for="image_id">新头像:
        {% load static %}
        <img src="{% static "img/default.png" %}" alt="图片显示失败" width="100px" style="margin-left: 10px" id="my_image">
        </label>
        <input type="file" id="image_id" name="avatar" style="display: none">
    </p>
        <input type="submit" value="提交" class="btn-info" />
    </form>
{% endblock %}

{% block js %}
    <script>
        $("#image_id").change(function () {
            //文件阅读器对象
            //1、先生成一个文件阅读器对象
            let myFileReaderObj=new FileReader();
            //2、获取用户上传的头像文件
            let fileObj=$(this)[0].files[0];
            //3、将文件对象交给阅读器对象读取
            myFileReaderObj.readAsDataURL(fileObj);//这是异步操作并且是IO操作
            //4、利用文件阅读器，将文件展示到前端页面  修改img 的src属性
            //等待文件阅读器读取完毕之后，在执行
            myFileReaderObj.onload=function(){
                $("#my_image").attr("src",myFileReaderObj.result)  //改变img标签属性src的值，值为一串二进制信息，也可以用于显示图片。
            }
        });
    </script>
{% endblock %}